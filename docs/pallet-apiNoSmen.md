
# API документация по работе с поддонами

## Общая информация

Модуль API для работы с поддонами на станках без сменного задания. Все запросы выполняются по базовому URL: `/pallets`.

## Эндпоинты

### 1. Начать обработку поддона на станке

**URL**: `/pallets/start-processing`  
**Метод**: POST  
**Описание**: Начинает процесс обработки поддона на указанном станке

#### Запрос:
```json
{
  "palletId": 1,     // ID поддона (обязательное поле)
  "machineId": 2,    // ID станка (обязательное поле)
  "operatorId": 3    // ID оператора, выполняющего обработку (опционально)
}
```

#### Ответ в случае успеха (HTTP 201):
```json
{
  "id": 42,          // ID созданной операции
  "productionPallet": {
    "id": 1,
    "name": "Поддон-001",
    "quantity": 50,
    // Информация о детали на поддоне
    "detail": {
      "id": 10,
      "article": "АРТ-123",
      "name": "Деталь XYZ",
      "material": "ДСП",
      "size": "1200x600"
      // и другие поля детали
    }
  },
  "processStep": {
    "id": 5,
    "name": "Распил",
    "sequence": 1
    // и другие поля этапа обработки
  },
  "machine": {
    "id": 2,
    "name": "Станок №2",
    "status": "ACTIVE"
    // и другие поля станка
  },
  "operator": {
    "id": 3,
    "username": "operator1",
    "details": {
      "fullName": "Иванов Иван",
      "position": "Оператор станка"
      // и другие детали оператора
    }
  },
  "status": "IN_PROGRESS",
  "quantity": 50,
  "startedAt": "2023-11-10T12:34:56Z"
}
```

#### Возможные ошибки (HTTP 400):
- `"Поддон не найден"` - указан несуществующий ID поддона
- `"Станок не найден"` - указан несуществующий ID станка
- `"У поддона не указан текущий этап обработки. Невозможно начать обработку"` - не задан текущий этап обработки для поддона
- `"Данный станок не может выполнять текущий этап обработки поддона"` - станок не подходит для текущего этапа обработки
- `"Поддон уже находится в обработке на другом станке"` - поддон уже обрабатывается

### 2. Завершить обработку поддона на станке

**URL**: `/pallets/complete-processing`  
**Метод**: POST  
**Описание**: Завершает процесс обработки поддона на станке

#### Запрос:
```json
{
  "palletId": 1,     // ID поддона (обязательное поле)
  "machineId": 2,    // ID станка (обязательное поле)
  "operatorId": 3,   // ID оператора, завершающего обработку (опционально)
  "segmentId": 4     // ID производственного участка (опционально)
}
```

#### Ответ в случае успеха (HTTP 200):
```json
{
  "operation": {
    "id": 42,
    "status": "COMPLETED",
    "completedAt": "2023-11-10T14:15:22Z",
    "isCompletedForDetail": true
    // и другие поля операции
  },
  "pallet": {
    "id": 1,
    "name": "Поддон-001",
    "currentStepId": 6,  // ID следующего этапа обработки (null если обработка полностью завершена)
    "detail": {
      // информация о детали
    },
    "currentStep": {
      // информация о следующем этапе (если есть)
    }
  },
  "nextStep": "Установлен следующий этап обработки"  // или "Обработка завершена" если это был последний этап
}
```

#### Возможные ошибки (HTTP 400):
- `"Поддон не найден"` - указан несуществующий ID поддона
- `"Станок не найден"` - указан несуществующий ID станка
- `"У поддона не указан текущий этап обработки. Невозможно завершить обработку"` - не задан текущий этап обработки для поддона
- `"Не найдена активная операция для поддона на станке с текущим этапом"` - система не может найти активную операцию с указанными параметрами
- `"Для завершения операции требуется указать оператора"` - не указан оператор при завершении и нет оператора в начале операции

## Примеры использования

### 1. Начало обработки поддона:

```http
POST /pallets/start-processing
Content-Type: application/json

{
  "palletId": 1,
  "machineId": 2,
  "operatorId": 3
}
```

### 2. Завершение обработки поддона:

```http
POST /pallets/complete-processing
Content-Type: application/json

{
  "operationId": 42,
  "operatorId": 3
}
```
